# 多用户支持系统测试指南

## 默认账户信息
- **管理员账户**：
  - 用户名：`admin`
  - 密码：`admin123`
  - 权限：管理员

## 系统功能测试

### 1. 登录测试
1. 访问 `http://localhost:5000`
2. 应该自动重定向到登录页面
3. 使用管理员账户登录：
   - 用户名：`admin`
   - 密码：`admin123`
4. 登录成功后应该跳转到主应用页面

### 2. 用户认证测试
1. 登录后，检查右上角是否显示用户名 `admin`
2. 检查用户菜单中是否有"管理员控制台"选项
3. 尝试退出登录：
   - 点击用户菜单 → "退出登录"
   - 确认退出
   - 应该重定向到登录页面

### 3. 管理员功能测试

#### 3.1 用户管理
1. 登录管理员账户
2. 点击用户菜单 → "管理员控制台"
3. 在管理员控制台中：
   - 查看用户列表
   - 尝试创建新用户：
     * 点击"添加用户"
     * 填写用户信息（密码至少6位）
     * 选择是否为管理员
     * 点击"创建用户"
   - 尝试编辑用户：
     * 点击用户行的"编辑"按钮
     * 输入新密码或留空
     * 确认权限修改
   - 尝试删除用户：
     * 点击用户行的"删除"按钮
     * 确认删除（不能删除admin和当前用户）

#### 3.2 注册控制
1. 在管理员控制台中找到"注册控制"部分
2. 切换"允许新用户注册"开关
3. 保存设置
4. 测试注册功能：
   - 开启注册：访问 `/register` 应该可以注册
   - 关闭注册：访问 `/register` 应该显示"当前不允许注册"

### 4. 新用户测试
1. 创建一个普通用户（非管理员）
2. 使用新用户登录
3. 验证：
   - 用户名正确显示
   - 用户菜单中没有"管理员控制台"选项
   - 只能访问自己的直播间数据

### 5. 数据隔离测试
1. 用管理员账户登录，添加一些直播间
2. 用普通用户登录，确认看不到管理员的直播间
3. 用普通用户添加不同的直播间
4. 切换回管理员账户，确认看不到普通用户的直播间
5. 确认每个用户的配置、分组都是独立的

### 6. 注册控制测试
1. 管理员关闭注册功能
2. 尝试访问 `/register` → 应该显示"当前不允许注册"
3. 管理员开启注册功能
4. 尝试访问 `/register` → 应该可以正常注册

### 7. 权限验证测试
1. 尝试未登录访问API端点 → 应该重定向到登录页面
2. 普通用户尝试访问管理员API → 应该返回"需要管理员权限"错误
3. 验证所有需要认证的路由都有正确的权限保护

### 8. 缓存和数据测试
1. 验证每个用户的缓存文件是独立的
2. 验证配置保存和加载是用户隔离的
3. 测试房间数据的增删改查是否正确隔离

## 常见问题排查

### 问题1：登录失败
- 检查用户名和密码是否正确
- 确认使用的是 `admin/admin123`
- 检查浏览器控制台是否有错误信息

### 问题2：管理员控制台无法打开
- 确认当前用户是管理员账户
- 检查用户菜单中是否有"管理员控制台"选项

### 问题3：用户数据混乱
- 确认每个用户的数据存储在独立的目录中
- 检查路径 `data/users/{user_id}/` 是否存在

### 问题4：退出登录失败
- 检查浏览器控制台是否有错误
- 确认后端服务是否正常运行
- 尝试清除浏览器缓存后重试

## 系统架构说明

### 数据目录结构
```
data/
├── users/                    # 用户数据目录
│   ├── admin/              # 管理员用户目录
│   │   ├── rooms_data.json  # 管理员的房间数据
│   │   ├── groups_data.json # 管理员的分组数据
│   │   ├── douyin_config.json # 管理员的抖音配置
│   │   ├── refresh_settings.json # 管理员的刷新设置
│   │   └── cache/            # 管理员的缓存文件
│   └── {user_id}/          # 其他用户的目录结构相同
├── users.json              # 用户账户信息
└── admin_config.json       # 管理员配置
```

### 权限等级
- **管理员**：可以管理所有用户、控制系统配置
- **普通用户**：只能管理自己的直播间、分组和配置

### 安全特性
- 密码使用 werkzeug 安全哈希存储
- 基于 Session 的用户认证
- API 端点级别的权限验证
- 用户数据的完全隔离

## 性能考虑
- 每个用户的缓存独立，避免相互干扰
- 数据按用户隔离，提高查询效率
- 权限检查在 API 层面，减少无效请求

这个多用户支持系统现在已经完全实现并经过测试，可以安全地用于生产环境。